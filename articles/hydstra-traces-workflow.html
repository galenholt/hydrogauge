<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hydstra workflow • hydrogauge</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="hydstra workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrogauge</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hydrogauge.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hydrogauge.html">hydrogauge</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-traces-workflow.html">hydstra workflow</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-workflow.html">KiWIS workflow</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-wrapper.html">hydstra wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-wrapper.html">KiWIS wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/data-portals.html">Data portals</a></li>
    <li><a class="dropdown-item" href="../articles/BOM_quality_codes.html">BOM quality codes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/galenholt/hydrogauge/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>hydstra workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/galenholt/hydrogauge/blob/HEAD/vignettes/articles/hydstra-traces-workflow.Rmd" class="external-link"><code>vignettes/articles/hydstra-traces-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>hydstra-traces-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/galenholt/hydrogauge/" class="external-link">hydrogauge</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>At present, we largely assume the user will have a list of gauges
they want, as the current ability to programatically obtain gauge
numbers according to criteria is limited (but see
<code><a href="../reference/get_sites_by_datasource.html">get_sites_by_datasource()</a></code>, which allows asking for all
sites that have a given datasource). This vignette walks through the
process with the core functions, for experimental wrappers that abstract
some of this, see <a href="hydstra-wrapper.Rmd">their vignette</a>.</p>
<p>To get timeseries, the user needs to ask for specific variables and
timespans. Sometimes these are known <em>a priori</em>, e.g. if a gauge
was chosen because it is known to have flow for a desired period.
However, finding available variables and their periods of record can
also be done through the functions here. This is one of the main
purposes of this package; we want to be able to query available
data.</p>
<p>This vignette will proceed with a set of sites chosen to span a range
of characteristics useful for this demonstration.</p>
<ul>
<li><p>The Upper Steavenson (405328) only has flow</p></li>
<li><p>Barwon (233217) has many variables, but their start dates
differ</p></li>
<li><p>Taggerty (405331) is no longer in operation- ran
2010-2013</p></li>
<li><p>Marysville golf course (405837) is only rainfall</p></li>
</ul>
<p>The functions all require gauges to be their numeric codes as
characters. The API needs a comma-separated string
(<code>"number1, number2"</code> ) , but the functions here will accept
a vector <code>c("number1", "number2"</code>) and decompose it
internally. This is typically easier and reflects more common R
workflows such as having a column of site numbers in a dataframe.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">barwon</span> <span class="op">&lt;-</span> <span class="st">'233217'</span></span>
<span><span class="va">steavenson</span> <span class="op">&lt;-</span> <span class="st">'405328'</span></span>
<span><span class="va">taggerty</span> <span class="op">&lt;-</span> <span class="st">'405331'</span></span>
<span><span class="va">golf</span> <span class="op">&lt;-</span> <span class="st">'405837'</span></span></code></pre></div>
<div class="section level2">
<h2 id="querying-available-data">Querying available data<a class="anchor" aria-label="anchor" href="#querying-available-data"></a>
</h2>
<p>Before asking for timeseries data, we want to ask what data is
available. we use</p>
<div class="section level3">
<h3 id="finding-datasources">Finding datasources<a class="anchor" aria-label="anchor" href="#finding-datasources"></a>
</h3>
<p>To see what datasources are available for a site, use
<code><a href="../reference/get_datasources_by_site.html">get_datasources_by_site()</a></code>. I typically use “A”, but it’s
worth looking to see what datasources are available for a target
site(s), and then doing the next step (finding variables) for each, to
see whether the available variables (or timeperiods) differ. <em>Note-
there are often other datasources that work but are not returned
here.</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_datasources_by_site.html">get_datasources_by_site</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'Vic'</span>, </span>
<span>                              site_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">barwon</span>, <span class="va">steavenson</span>, </span>
<span>                                            <span class="va">taggerty</span>, <span class="va">golf</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ds</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">#&gt;    site   datasource</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 233217 A         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 233217 TELEM     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 233217 TELEMCOPY </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 405328 A         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 405328 TELEM     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 405328 TELEMCOPY </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 405331 A         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 405837 A         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 405837 TELEM     </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 405837 TELEMCOPY</span></span></code></pre></div>
<p>Plot that to see data availability (@ref(fig:datasource)).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_datasources_by_site.html">plot_datasources_by_site</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(site, datasource)`</span></span></code></pre></div>
<div class="figure">
<img src="hydstra-traces-workflow_files/figure-html/fig-datasource-1.png" alt="Datasources available for each gauge. These are what are returned by the API, but may not be complete. Specifying other datasources on a pull may work." width="700"><p class="caption">
Datasources available for each gauge. These are what are returned by the
API, but may not be complete. Specifying other datasources on a pull may
work.
</p>
</div>
</div>
<div class="section level3">
<h3 id="finding-available-variables-and-timespans">Finding available variables and timespans<a class="anchor" aria-label="anchor" href="#finding-available-variables-and-timespans"></a>
</h3>
<p>We then need to know what variables are available to extract
timeseries of. We use <code><a href="../reference/get_variable_list.html">get_variable_list()</a></code> to get this
information, including both their names and numbers, as well as other
details such as the time period of record and units.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_variable_list.html">get_variable_list</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'Vic'</span>, </span>
<span>                              site_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">barwon</span>, <span class="va">taggerty</span>, </span>
<span>                                            <span class="va">steavenson</span>, <span class="va">golf</span><span class="op">)</span>, </span>
<span>                              datasource <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span></span></code></pre></div>
<p>That returns a tibble with information about each gauge and variable
(<span class="citation">@tbl-vars</span>). A few things to note- it
gives the names of the gauges, the names and values of the variables,
and a start and end date for each. For example, the Barwon’s start date
for stage (100) is 1961, while the others (pH, ppm, etc) didn’t start
until 2010.</p>
<p><em>Note that this does <strong>not</strong> return derived discharge
variables (140 and 141)</em>. If variable 100 (stage height) exists, the
other two usually do, though sometimes not if there is no ratings
curve.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_info</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 11</span></span></span>
<span><span class="co">#&gt;    site   short_name       long_name variable units var_name period_start       </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 233217 BARWON @ GEELONG BARWON R… 100.00   metr… Stream … 1961-03-06 <span style="color: #949494;">07:15:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 233217 BARWON @ GEELONG BARWON R… 210.00   pH    Acidity… 2010-07-06 <span style="color: #949494;">02:31:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 233217 BARWON @ GEELONG BARWON R… 215.00   ppm   Dissolv… 2010-07-06 <span style="color: #949494;">02:31:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 233217 BARWON @ GEELONG BARWON R… 450.00   Degr… Water T… 2010-07-06 <span style="color: #949494;">02:31:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 233217 BARWON @ GEELONG BARWON R… 810.00   NTU   Turbidi… 2010-07-06 <span style="color: #949494;">02:31:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 233217 BARWON @ GEELONG BARWON R… 820.00   µS/c… Conduct… 2010-07-06 <span style="color: #949494;">02:31:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 405331 TAGGERTY R LADY… TAGGERTY… 100.00   metr… Stream … 2010-07-29 <span style="color: #949494;">02:20:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 405331 TAGGERTY R LADY… TAGGERTY… 450.00   Degr… Water T… 2010-07-29 <span style="color: #949494;">02:20:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 405331 TAGGERTY R LADY… TAGGERTY… 810.00   NTU   Turbidi… 2010-07-29 <span style="color: #949494;">02:20:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 405331 TAGGERTY R LADY… TAGGERTY… 820.00   µS/c… Conduct… 2010-07-29 <span style="color: #949494;">02:20:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 405328 STEAVENSON R @ … STEAVENS… 100.00   metr… Stream … 2009-11-19 <span style="color: #949494;">07:08:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 405837 R.G. MARYSVILLE  RAINGAUG… 10.00    mm    Rainfal… 2001-06-21 <span style="color: #949494;">04:27:00</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4 more variables: period_end &lt;dttm&gt;, subdesc &lt;chr&gt;, datasource &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   database_timezone &lt;chr&gt;</span></span></span></code></pre></div>
<p>Depending on the goals, it can be helpful to visualise this as the
availability of each variable (@ref(fig:vars-duration)) or the period of
record of each variable (@ref(fig:vars-period)).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_info</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="va">period_end</span><span class="op">-</span><span class="va">period_start</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">var_name</span>, y <span class="op">=</span> <span class="va">site</span>, fill <span class="op">=</span> <span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">'plasma'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="hydstra-traces-workflow_files/figure-html/fig-vars-duration-1.png" alt="Availability of each variable at each gauge, with color indicating the duration of record in days." width="700"><p class="caption">
Availability of each variable at each gauge, with color indicating the
duration of record in days.
</p>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var_info</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">starts_with</span><span class="op">(</span><span class="st">'period'</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">'startend'</span>, values_to <span class="op">=</span> <span class="st">'date'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">date</span>, x <span class="op">=</span> <span class="va">site</span>, color <span class="op">=</span> <span class="va">var_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="hydstra-traces-workflow_files/figure-html/fig-vars-period-1.png" alt="Availability of each variable at each gauge, with the period of record indicated by lines." width="700"><p class="caption">
Availability of each variable at each gauge, with the period of record
indicated by lines.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="obtaining-timeseries">Obtaining timeseries<a class="anchor" aria-label="anchor" href="#obtaining-timeseries"></a>
</h2>
<p>This is typically the main goal, with the other steps getting us to
the point of knowing what to ask for. Specifically,
<code><a href="../reference/get_variable_list.html">get_variable_list()</a></code> gives us a reference to know what the
variables are to ask for and the relevant timeperiods.</p>
<div class="section level3">
<h3 id="basic-operation">Basic operation<a class="anchor" aria-label="anchor" href="#basic-operation"></a>
</h3>
<p>In general, we use <code><a href="../reference/get_ts_traces.html">get_ts_traces()</a></code> for a set of sites,
variables, timeperiods, and statistics. The experimental wrapper
functions <code><a href="../reference/fetch_hydstra_timeseries.html">fetch_hydstra_timeseries()</a></code> and
<code><a href="../reference/fetch_timeseries.html">fetch_timeseries()</a></code> call <code><a href="../reference/get_ts_traces.html">get_ts_traces()</a></code>
internally. In any case, there are some pitfalls to avoid.</p>
<p>If we just want a set of variables that all need the same statistic
applied (e.g. daily mean flows), we can pass that in as a vector. For
example, to get daily mean stage height (100), discharge (here in
ML/day, 141), and temperature (450), we can do that in one call, even
for multiple gauges. Asking here for one year to keep the call
quick.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_days</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ts_traces.html">get_ts_traces</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'Vic'</span>, </span>
<span>                         site_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">barwon</span>, <span class="va">steavenson</span>, <span class="va">taggerty</span>, <span class="va">golf</span><span class="op">)</span>,</span>
<span>                         datasource <span class="op">=</span> <span class="st">"A"</span>, </span>
<span>                         var_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"100"</span>, <span class="st">"141"</span>, <span class="st">"450"</span><span class="op">)</span>,</span>
<span>                         start_time <span class="op">=</span> <span class="fl">20200101</span>,</span>
<span>                         end_time <span class="op">=</span> <span class="fl">20201231</span>,</span>
<span>                         interval <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>                         data_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>                         multiplier <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         returnformat <span class="op">=</span> <span class="st">'df'</span><span class="op">)</span></span></code></pre></div>
<p>That returns a tall dataframe with both the requested values and some
site metadata including the site name, location, etc (<span class="citation">@tbl-ts</span>), which the user can then split up or
plot how they want (e.g. @ref(fig:ts)). There are other options that
return lists of dataframes if the user does not want all sites and
variables combined-</p>
<ul>
<li><p><code>returnformat = "varlist"</code> a list with one tibble per
variable</p></li>
<li><p><code>returnformat = "sitelist"</code> a list with one tibble per
site</p></li>
<li><p><code>returnformat = "sxvlist"</code> a list with one tibble per
site x variable combo (including empty lists for missing
combos)</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rows.print doesn't really work with devtools::build_readme(), so use head</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ts_days</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 20</span></span></span>
<span><span class="co">#&gt;    error_num compressed site_short_name  longitude site_name   latitude org_name</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         0 0          BARWON @ GEELONG      144. BARWON RIV…    -<span style="color: #BB0000;">38.2</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more variables: value &lt;dbl&gt;, time &lt;dttm&gt;, quality_codes_id &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   site &lt;chr&gt;, variable_short_name &lt;chr&gt;, precision &lt;chr&gt;, subdesc &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   variable &lt;chr&gt;, units &lt;chr&gt;, variable_name &lt;chr&gt;, database_timezone &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   quality_codes &lt;chr&gt;, data_type &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_days</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">variable_short_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">variable_short_name</span> <span class="op">~</span> <span class="va">site_short_name</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="hydstra-traces-workflow_files/figure-html/fig-ts-1.png" alt="Timeseries of requested data, where available." width="700"><p class="caption">
Timeseries of requested data, where available.
</p>
</div>
<p>Note that if a variable isn’t available for a gauge it just isn’t
returned, and same with timeperiods. We requested data from all four
sites, but only the Barwon returns all variables. The golf course gauge
does not return anything because it does not collect these variables,
the Steavenson returns level and discharge but not temp, and the
Taggerty doesn’t appear at all despite having these variables because
we’ve asked for data after it was decommissioned.</p>
</div>
<div class="section level3">
<h3 id="multiple-variables-multiple-statistics">Multiple variables, multiple statistics<a class="anchor" aria-label="anchor" href="#multiple-variables-multiple-statistics"></a>
</h3>
<p>Now, if we want another set of variables that should have a different
statistic (e.g. rainfall makes sense as the daily sum, not the mean), we
need a separate call to get_ts_traces() with a different
<code>data_type</code> argument.</p>
<p>Note that again this will ignore gauges without the info
(@ref(tab:ts-rain-tab), @ref(fig:ts-rain-fig)).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_rain</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ts_traces.html">get_ts_traces</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'Vic'</span>, </span>
<span>                         site_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">barwon</span>, <span class="va">golf</span><span class="op">)</span>, </span>
<span>                         datasource <span class="op">=</span> <span class="st">"A"</span>, </span>
<span>                         var_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10"</span><span class="op">)</span>,</span>
<span>                         start_time <span class="op">=</span> <span class="fl">20200101</span>,</span>
<span>                         end_time <span class="op">=</span> <span class="fl">20201231</span>,</span>
<span>                         interval <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>                         data_type <span class="op">=</span> <span class="st">"tot"</span>,</span>
<span>                         multiplier <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         returnformat <span class="op">=</span> <span class="st">'df'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ts_rain</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 20</span></span></span>
<span><span class="co">#&gt;    error_num compressed site_short_name longitude site_name    latitude org_name</span></span>
<span><span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>         0 0          R.G. MARYSVILLE      146. RAINGAUGE @…    -<span style="color: #BB0000;">37.5</span> Dept. S…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 13 more variables: value &lt;dbl&gt;, time &lt;dttm&gt;, quality_codes_id &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   site &lt;chr&gt;, variable_short_name &lt;chr&gt;, precision &lt;chr&gt;, subdesc &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   variable &lt;chr&gt;, units &lt;chr&gt;, variable_name &lt;chr&gt;, database_timezone &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   quality_codes &lt;chr&gt;, data_type &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_rain</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">variable_short_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">variable_short_name</span> <span class="op">~</span> <span class="va">site_short_name</span>, scales <span class="op">=</span> <span class="st">'free'</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="hydstra-traces-workflow_files/figure-html/fig-ts-rain-1.png" alt="Timeseries of rainfall data, where available." width="700"><p class="caption">
Timeseries of rainfall data, where available.
</p>
</div>
<p>If the user wants to combine across different statistics, use
<code><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">dplyr::bind_rows()</a></code> to combine post-hoc.</p>
<p>An automated approach that can simplify some common workflows
(especially pulling period of record for many gauges) is available in
<code><a href="../reference/fetch_hydstra_timeseries.html">fetch_hydstra_timeseries()</a></code>, but care must be taken to avoid
inappropriate statistics. See <a href="Hydstra-wrapper.Rmd">the
article</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Galen Holt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
