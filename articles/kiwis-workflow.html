<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>KiWIS workflow • hydrogauge</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="KiWIS workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrogauge</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hydrogauge.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hydrogauge.html">hydrogauge</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-traces-workflow.html">hydstra workflow</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-workflow.html">KiWIS workflow</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-wrapper.html">hydstra wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-wrapper.html">KiWIS wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/data-portals.html">Data portals</a></li>
    <li><a class="dropdown-item" href="../articles/BOM_quality_codes.html">BOM quality codes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/galenholt/hydrogauge/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>KiWIS workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/galenholt/hydrogauge/blob/HEAD/vignettes/articles/kiwis-workflow.Rmd" class="external-link"><code>vignettes/articles/kiwis-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>kiwis-workflow.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/galenholt/hydrogauge/" class="external-link">hydrogauge</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>At present, we largely assume the user will have a list of gauges
they want. The KiWIS interface does provide some opportunity to
programatically find gauge numbers according to criteria, using
<code><a href="../reference/getParameterList.html">getParameterList()</a></code>, <code><a href="../reference/getGroupList.html">getGroupList()</a></code>, and
<code><a href="../reference/getStationList.html">getStationList()</a></code> (most useful). This vignette, however,
assumes we have selected a set of gauges and want to identify variables
and pull their timeseries. For experimental wrappers that abstract some
of this, see <a href="kiwis-wrapper.Rmd">their vignette</a>.</p>
<p>Unlike Hydstra, which provides tailored arguments for different sorts
of API control, KiWIS primarily uses text search within columns. This
can be more flexible, but means we need to know column names and pay
close attention to the regex used to filter those columns to avoid
contaminating outputs. This generality means that no column is favoured
over others in filtering, and hydrogauge provides access to the full
search capability with the <code>extra_list</code> argument. However, we
also make a concession for consistency by making <code>station_no</code>
its own argument, corresponding to the <code>site_list</code> argument
in Hydstra.</p>
<div class="section level2">
<h2 id="querying-available-data">Querying available data<a class="anchor" aria-label="anchor" href="#querying-available-data"></a>
</h2>
<p>To get timeseries, the user needs to ask for specific variables and
timespans. Sometimes these are known <em>a priori</em>, e.g. if a gauge
was chosen because it is known to have flow for a desired period.
However, finding available variables and their periods of record can
also be done through the functions here, primarily
<code><a href="../reference/getTimeseriesList.html">getTimeseriesList()</a></code>. This is one of the main purposes of
this package; we want to be able to query available data.</p>
<div class="section level3">
<h3 id="finding-available-variables-and-timespans">Finding available variables and timespans<a class="anchor" aria-label="anchor" href="#finding-available-variables-and-timespans"></a>
</h3>
<p>Due to the search functionality of the KiWIS interface, we can use
gauge numbers as we do with hydstra, but we can also search more
generally. Note also that this returns a very large list, primarily due
to the values in <code>ts_id</code> and <code>ts_name</code> columns,
which arise because the various types of data and aggregations are given
unique values there, rather than being calculated, as they are for
hydstra.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">station_tslist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTimeseriesList.html">getTimeseriesList</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>, station_no <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'410730'</span>, <span class="st">'A4260505'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">station_tslist</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 200 × 14</span></span></span>
<span><span class="co">#&gt;    station_name    station_no station_id ts_id ts_name ts_unitname ts_unitsymbol</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> River Murray a… A4260505   1617110    2086… Receiv… cubic mete… cumec        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> River Murray a… A4260505   1617110    2086… Harmon… cubic mete… cumec        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> River Murray a… A4260505   1617110    2086… DMQaQc… cubic mete… cumec        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> River Murray a… A4260505   1617110    2086… DMQaQc… meter       m            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> River Murray a… A4260505   1617110    2086… DMQaQc… meter       m            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> River Murray a… A4260505   1617110    2086… Harmon… cubic mete… cumec        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> River Murray a… A4260505   1617110    2086… Harmon… meter       m            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> River Murray a… A4260505   1617110    2086… Receiv… meter       m            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> River Murray a… A4260505   1617110    2086… Combin… meter       m            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> River Murray a… A4260505   1617110    2086… DMQaQc… meter       m            </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 190 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7 more variables: ts_path &lt;chr&gt;, parametertype_id &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parametertype_name &lt;chr&gt;, stationparameter_name &lt;chr&gt;, from &lt;dttm&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   to &lt;dttm&gt;, database_timezone &lt;chr&gt;</span></span></span></code></pre></div>
<p>We can visualise the time period for each parameter at each gauge
(here limited only to the QA’ed daily means).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">station_tslist</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'DMQaQc.Merged.DailyMean.24HR'</span>, <span class="va">ts_name</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">to</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">'startend'</span>, values_to <span class="op">=</span> <span class="st">'date'</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">date</span>, x <span class="op">=</span> <span class="va">station_no</span>, color <span class="op">=</span> <span class="va">parametertype_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-workflow_files/figure-html/fig-vars-period-1.png" alt="Availability of each variable at each gauge, with the period of record indicated by lines." width="700"><p class="caption">
Availability of each variable at each gauge, with the period of record
indicated by lines.
</p>
</div>
<p>We can take advantage of the search capability to ignore gauge
numbers entirely, returning all sites meeting some regex pattern, here
those with <code>'River Murray'</code> in the <code>station_name</code>.
We do this with the <code>extra_list</code> argument, which takes column
names as names and the seach pattern as the item. This approach works
for any column, and so we also only look at the “DMQaQc” data at a Daily
Mean aggregation. The <code>returnfields</code> argument lets us choose
which columns to return. We include ‘coverage’ here to the returnfields
to get the period of record.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RM_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTimeseriesList.html">getTimeseriesList</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>                           extra_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>station_name <span class="op">=</span> <span class="st">'River Murray*'</span>,</span>
<span>                                             ts_name <span class="op">=</span> <span class="st">'DMQaQc.Merged.DailyMean.24HR'</span><span class="op">)</span>,</span>
<span>                           returnfields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'station_no'</span>, <span class="st">'station_name'</span>,</span>
<span>                                            <span class="st">'ts_name'</span>, <span class="st">'ts_id'</span>, </span>
<span>                                            <span class="st">'ts_unitname'</span>, <span class="st">'parametertype_name'</span>,</span>
<span>                                            <span class="st">'coverage'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RM_ts</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 199 × 9</span></span></span>
<span><span class="co">#&gt;    station_no station_name          ts_name ts_id ts_unitname parametertype_name</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> A4260573   River Murray at Wool… DMQaQc… 2107… degree Cel… Water Temperature </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> A4260624   River Murray at Love… DMQaQc… 2118… meter       Water Course Level</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> A4260632   River Murray at Temp… DMQaQc… 2121… meter       Water Course Level</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> A4260643   River Murray at Habe… DMQaQc… 2124… microsieme… Electrical Conduc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> A4260507   River Murray at Lock… DMQaQc… 2087… meter       Water Course Level</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> A4260509   River Murray at Lock… DMQaQc… 2087… microsieme… Electrical Conduc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> A4260521   River Murray at Mann… DMQaQc… 2091… microsieme… Electrical Conduc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> A4260522   River Murray at Murr… DMQaQc… 2092… meter       Water Course Level</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> A4260522   River Murray at Murr… DMQaQc… 2092… degree Cel… Water Temperature </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> A4260532   River Murray at Well… DMQaQc… 2097… meter       Water Course Level</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 189 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: from &lt;dttm&gt;, to &lt;dttm&gt;, database_timezone &lt;chr&gt;</span></span></span></code></pre></div>
<p>We can visualise the availability of each variable at each gauge
(@ref(fig:vars-duration)).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RM_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>duration <span class="op">=</span> <span class="va">to</span><span class="op">-</span><span class="va">from</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">parametertype_name</span>, y <span class="op">=</span> <span class="va">station_no</span>, fill <span class="op">=</span> <span class="va">duration</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">'plasma'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-workflow_files/figure-html/fig-vars-duration-1.png" alt="Availability of each variable at each gauge, with color indicating the duration of record in days." width="700"><p class="caption">
Availability of each variable at each gauge, with color indicating the
duration of record in days.
</p>
</div>
<div class="callout-note">
<p>The available returnfields are poorly documented. The default are
those returned above for <code>station_tslist</code>,</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">station_tslist</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">station_tslist</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'from'</span>, <span class="st">'to'</span>, <span class="st">'database_timezone'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] "station_name"          "station_no"            "station_id"           </span></span>
<span><span class="co">#&gt;  [4] "ts_id"                 "ts_name"               "ts_unitname"          </span></span>
<span><span class="co">#&gt;  [7] "ts_unitsymbol"         "ts_path"               "parametertype_id"     </span></span>
<span><span class="co">#&gt; [10] "parametertype_name"    "stationparameter_name"</span></span></code></pre></div>
<p>But there are others that can be requested. In particular, ‘coverage’
is needed to get the period of record.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># According to kisters, these exist</span></span>
<span>  <span class="va">all_return</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'station_name'</span>, <span class="st">'station_latitude'</span>, <span class="st">'station_longitude'</span>, <span class="st">'station_carteasting'</span>, <span class="st">'station_cartnorthing'</span>, <span class="st">'station_local_x'</span>, <span class="st">'station_local_y'</span>, <span class="st">'station_georefsystem'</span>, <span class="st">'station_longname'</span>, <span class="st">'ts_id'</span>, <span class="st">'ts_name'</span>, <span class="st">'ts_shortname'</span>, <span class="st">'ts_path'</span>, <span class="st">'ts_type_id'</span>, <span class="st">'ts_type_name'</span>, <span class="st">'parametertype_id'</span>, <span class="st">'parametertype_name'</span>, <span class="st">'stationparameter_name'</span>, <span class="st">'stationparameter_no'</span>, <span class="st">'stationparameter_longname'</span>, <span class="st">'ts_unitname'</span>, <span class="st">'ts_unitsymbol'</span>, <span class="st">'ts_unitname_abs'</span>, <span class="st">'ts_unitsymbol_abs'</span>, <span class="st">'site_no'</span>, <span class="st">'site_id'</span>, <span class="st">'site_name'</span>, <span class="st">'catchment_no'</span>, <span class="st">'catchment_id'</span>, <span class="st">'catchment_name'</span>, <span class="st">'coverage'</span>, <span class="st">'ts_density'</span>, <span class="st">'ts_exchange'</span>, <span class="st">'ts_spacing'</span>, <span class="st">'ts_clientvalue##'</span>, <span class="st">'datacart'</span>, <span class="st">'ca_site'</span>, <span class="st">'ca_sta'</span>, <span class="st">'ca_par'</span>, <span class="st">'ca_ts'</span><span class="op">)</span></span>
<span>  <span class="co"># I get http 500 errors unless cut to</span></span>
<span>  <span class="va">sub_return</span> <span class="op">&lt;-</span> <span class="va">all_return</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">34</span>, <span class="fl">37</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">sub_return</span></span>
<span><span class="co">#&gt;  [1] "station_name"              "station_latitude"         </span></span>
<span><span class="co">#&gt;  [3] "station_longitude"         "station_carteasting"      </span></span>
<span><span class="co">#&gt;  [5] "station_cartnorthing"      "station_local_x"          </span></span>
<span><span class="co">#&gt;  [7] "station_local_y"           "station_georefsystem"     </span></span>
<span><span class="co">#&gt;  [9] "station_longname"          "ts_id"                    </span></span>
<span><span class="co">#&gt; [11] "ts_name"                   "ts_shortname"             </span></span>
<span><span class="co">#&gt; [13] "ts_path"                   "ts_type_id"               </span></span>
<span><span class="co">#&gt; [15] "ts_type_name"              "parametertype_id"         </span></span>
<span><span class="co">#&gt; [17] "parametertype_name"        "stationparameter_name"    </span></span>
<span><span class="co">#&gt; [19] "stationparameter_no"       "stationparameter_longname"</span></span>
<span><span class="co">#&gt; [21] "ts_unitname"               "ts_unitsymbol"            </span></span>
<span><span class="co">#&gt; [23] "ts_unitname_abs"           "ts_unitsymbol_abs"        </span></span>
<span><span class="co">#&gt; [25] "site_no"                   "site_id"                  </span></span>
<span><span class="co">#&gt; [27] "site_name"                 "catchment_no"             </span></span>
<span><span class="co">#&gt; [29] "catchment_id"              "catchment_name"           </span></span>
<span><span class="co">#&gt; [31] "coverage"                  "ts_density"               </span></span>
<span><span class="co">#&gt; [33] "ts_exchange"               "ts_spacing"               </span></span>
<span><span class="co">#&gt; [35] "ca_site"                   "ca_sta"                   </span></span>
<span><span class="co">#&gt; [37] "ca_par"                    "ca_ts"</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="obtaining-timeseries">Obtaining timeseries<a class="anchor" aria-label="anchor" href="#obtaining-timeseries"></a>
</h2>
<p>To pull timeseries, we need to know either the <code>ts_id</code> or
<code>ts_path</code> arguments that we want. This filters on those
columns to ensure we get the timeseries we want. Note in both
<code>station_tslist</code> and <code>RM_ts</code> that each row
(defined by station, variable, aggregation, QA’d, etc) gets its own
<code>ts_id</code> value. We need to choose the ones we want.</p>
<div class="callout-tip">
<p>The find_ts_id() function helps us find desired <code>ts_id</code>
values. It is a wrapper over <code><a href="../reference/getTimeseriesList.html">getTimeseriesList()</a></code> with regex
to select what we want. As such, it’s not in the raw API workflow, but
is very handy. See <a href="kiwis-wrapper.Rmd">the wrapper
vignette</a></p>
</div>
<div class="callout-note">
<p>In choosing these <code>ts_ids</code>, we’re making many of the same
decisions we would make when asking the hydstra function
<code><a href="../reference/get_ts_traces.html">get_ts_traces()</a></code> for <code>site_list</code>,
<code>datasource</code>, <code>var_list</code>, <code>interval</code>,
<code>data_type</code>, and <code>multiplier</code>. This has pluses and
minuses. It’s much harder here to ask for what we want (but see
<code>find_ts_ids()</code>), but because each aggregation is
pre-supplied and indexed uniquely it’s much easier to get different
aggregations from different variables in one call.</p>
</div>
<p>Let’s demonstrate with some ts_id values from
<code>station_tslist</code> to pull daily mean QaQc’ed values for level,
discharge, and water temp. Note that we have to ask for discharge and
level with separate ts_ids for each gauge. This is another argument for
using <code><a href="../reference/find_ts_id.html">find_ts_id()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">'208669010'</span>, <span class="st">'208648010'</span>, <span class="co"># level and discharge Lock 9</span></span>
<span>  <span class="st">'1573010'</span>, <span class="st">'1598010'</span>, <span class="co"># level and discharge Cotter R.</span></span>
<span>  <span class="st">'380167010'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We’ll just pull one year</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTimeseriesValues.html">getTimeseriesValues</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>                                  ts_id <span class="op">=</span> <span class="va">ts_example</span>,</span>
<span>                                  start_time <span class="op">=</span> <span class="fl">20100101</span>,</span>
<span>                                  end_time <span class="op">=</span> <span class="fl">20101231</span><span class="op">)</span></span></code></pre></div>
<p>That provides a tall dataframe containing additional information
about the gauge (<span class="citation">@tbl-ts</span>). The returned
columns can again be adjusted with <code>returnfields</code> and
<code>meta_returnfields</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rows.print doesn't really work with devtools::build_readme(), so use head</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ts_example</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 30 × 14</span></span></span>
<span><span class="co">#&gt;    ts_id     station_name  station_latitude station_longitude parametertype_name</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 208648010 River Murray… <span style="color: #949494;">""</span>               <span style="color: #949494;">""</span>                Water Course Disc…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 9 more variables: ts_name &lt;chr&gt;, ts_unitname &lt;chr&gt;, ts_unitsymbol &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   station_no &lt;chr&gt;, station_id &lt;chr&gt;, value &lt;dbl&gt;, quality_code &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   time &lt;dttm&gt;, database_timezone &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_example</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">parametertype_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">parametertype_name</span> <span class="op">~</span> <span class="va">station_name</span>, scales <span class="op">=</span> <span class="st">'free'</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-workflow_files/figure-html/fig-ts-1.png" alt="Timeseries of requested data, where available." width="700"><p class="caption">
Timeseries of requested data, where available.
</p>
</div>
<p>A common use will be asking for the period of record, so we show that
here for these two gauges. We use the <code>period = 'complete'</code>
argument to take advantage of internal API functionality (which also
allows period units like ‘P2W’).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ts_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTimeseriesValues.html">getTimeseriesValues</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>                                  ts_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'208648010'</span>, <span class="st">'1573010'</span><span class="op">)</span>,</span>
<span>                                  period <span class="op">=</span> <span class="st">'complete'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_all</span> <span class="op">|&gt;</span> </span>
<span>  <span class="co"># dplyr::filter(value &gt;= 0) |&gt; </span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">station_name</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">'free'</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-workflow_files/figure-html/fig-ts-all-1.png" alt="Timeseries of period of record for discharge." width="700"><p class="caption">
Timeseries of period of record for discharge.
</p>
</div>
<p>An automated approach that can simplify some common workflows
(especially pulling period of record for many gauges and programatically
selecting variables across gauges) is available in
<code><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries()</a></code>. See <a href="kiwis-wrapper.Rmd">the article</a>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Galen Holt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
