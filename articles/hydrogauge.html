<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>hydrogauge • hydrogauge</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="hydrogauge">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrogauge</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/hydrogauge.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hydrogauge.html">hydrogauge</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-traces-workflow.html">hydstra workflow</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-workflow.html">KiWIS workflow</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-wrapper.html">hydstra wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-wrapper.html">KiWIS wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/data-portals.html">Data portals</a></li>
    <li><a class="dropdown-item" href="../articles/BOM_quality_codes.html">BOM quality codes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/galenholt/hydrogauge/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>hydrogauge</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/galenholt/hydrogauge/blob/HEAD/vignettes/articles/hydrogauge.Rmd" class="external-link"><code>vignettes/articles/hydrogauge.Rmd</code></a></small>
      <div class="d-none name"><code>hydrogauge.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/galenholt/hydrogauge/" class="external-link">hydrogauge</a></span><span class="op">)</span></span></code></pre></div>
<p>A typical workflow for hydrogauge involves querying the database to
find gauges, querying the available records for a set of gauges, and
then pulling desired timeseries. Both APIs (hydllp and KiWIS) have
similar ability to perform these steps, but are called differently.</p>
<p>In general, the function names that hit the API directly are named as
in the relevant API calls, with hydstra names looking like
<code>get_hydstra_function()</code>, and KiWIS looking like
<code>getKiwisFunction()</code>.</p>
<p>For an example of this common workflow, see the respective <a href="hydstra_traces_workflow.Rmd">hydstra</a> and <a href="kiwis_workflow.Rmd">KiWIS</a> articles.</p>
<div class="section level2">
<h2 id="which-api">Which API?<a class="anchor" aria-label="anchor" href="#which-api"></a>
</h2>
<p>How do you know which API style you have? It’s best to find
documentation. hydrogauge does try to infer, though there are no
guarantees it always will guess right. To find this inference, run
<code><a href="../reference/parse_url.html">parse_url()</a></code> with <code>test = TRUE, type = TRUE</code>:</p>
<p>BOM (KiWIS)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parse_url.html">parse_url</a></span><span class="op">(</span><span class="st">'http://www.bom.gov.au/waterdata/services'</span>, test <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   baseURL                                  portal_type</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> http://www.bom.gov.au/waterdata/services kiwis</span></span></code></pre></div>
<p>NSW (hydstra)</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parse_url.html">parse_url</a></span><span class="op">(</span><span class="st">'https://realtimedata.waternsw.com.au/cgi/webservice.exe?'</span>, test <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   baseURL                                                  portal_type</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> https://realtimedata.waternsw.com.au/cgi/webservice.exe? hydstra</span></span></code></pre></div>
<p>An API-agnostic wrapper is in development, though it will always
still work best if the type is known <em>a priori</em>.</p>
</div>
<div class="section level2">
<h2 id="times">Times<a class="anchor" aria-label="anchor" href="#times"></a>
</h2>
<p>Both sets of API (Hydstra/hydllp and kiwis) expect times to be
database-local and return times local to the database (not the user, not
necessarily the gauge itself). This package provides some functionality
to return times in other formats (see <code>return_timezone</code>
argument), including a standard parseable character format, UTC, and
local time objects. In general, working with UTC and offsets is
preferable, but care should be taken when giving desired start and end
times, as these need to be in database-local time.</p>
</div>
<div class="section level2">
<h2 id="hydstra-definitions-and-available-options">Hydstra definitions and available options<a class="anchor" aria-label="anchor" href="#hydstra-definitions-and-available-options"></a>
</h2>
<p>I have tried to keep the function argument names the same as in the
API, and the API restricts the options to the function arguments. The
API functions are documented by <a href="https://kisters.com.au/doco/hydllp.htm" class="external-link">Kisters</a> (the
creators), and there is a bit more information about options from <a href="https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf" class="external-link">Queensland</a>,
though there are discrepancies between states.</p>
<p>After quite a lot of digging and testing, an incomplete set of
definitions of common arguments and their potential values follows:</p>
<ul>
<li><p><code>site_list</code> is the gauge number as a character (and
the functions here accept a vector of these gauge numbers). Can be any
gauge number in the database. Obtaining them programatically is limited
currently, except in <code>get_sites_by_datasource</code>.</p></li>
<li>
<p><code>datasource</code> The type of data. Victoria returns
<code>"A"</code>, <code>"TELEM"</code>, and <code>"TELEMCOPY"</code>
from get_datasources_by_site(), but there may be others and sites I have
not examined. <code>A</code> is ‘archive’, <code>TELEM</code> is
‘telemetry’, and I’m not sure why there’s a copy. <code>"CP"</code>
seems to work in NSW, Victoria, and QLD, but isn’t documented anywhere I
can find.</p>
<ul>
<li>Some quick testing with <code>get_sites_by_datasource</code> shows
that there are many more sites with <code>A</code> than
<code>TELEM</code>, but that <code>TELEM</code> is not a subset- there
are sites with <code>TELEM</code> and not <code>A</code>. Initial
testing of <code>get_db_info</code> also finds sites that do not appear
with any of these, and seem to have no data.</li>
</ul>
</li>
<li>
<p><code>var_list</code> is the type of variable, e.g. rainfall,
flow, temp. Should be a character of the numeric code, with or without
trailing “.00”, and can be a vector, e.g. c(“100”, “210.00”).</p>
<ul>
<li><p>I do not currently have a comprehensive list of possible
variables and their meaning, but <code>get_variables_by_site</code> will
provide one for a set of sites.</p></li>
<li><p>The <a href="https://water-monitoring.information.qld.gov.au/wini/Documents/RDMW_API_doco.pdf" class="external-link">Queensland
documentation</a> gives some more information, but the numbers are not
always the same for different databases.</p></li>
<li><p>Some variables (typically discharge) are calculated, and <em>do
not appear in queries of available variables</em> such as
<code>get_variables_by_site</code>. Those I’m aware of are “141”-
discharge in ML/day, and “140”, discharge in cumecs
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>m</mi><mn>3</mn></msup><mi>/</mi><mi>s</mi><mi>e</mi><mi>c</mi></mrow><annotation encoding="application/x-tex">m^3/sec</annotation></semantics></math>).</p></li>
</ul>
</li>
<li>
<p><code>start_time</code> and <code>end_time</code> are the start
and end times of the period requested. The API is strict that these
should be 14-digit strings “YYYYMMDDHHIIEE”, but the functions here will
take them in date formats (posix), character, or numeric, and they do
not need to be 14-digits.</p>
<ul>
<li>If not dates, they <em>should</em> be at least YYYYMMDD (either
character or numeric), and the rest will be padded with zeros.</li>
</ul>
</li>
<li>
<p><code>interval</code> is the time interval of the return values
for timeseries. Options seem to be (based on API error messages)</p>
<ul>
<li><p><code>"year"</code>, <code>"month"</code>, <code>"day"</code>,
<code>"hour"</code>, <code>"minute"</code>, <code>"second"</code>. I
don’t think capitalisation matters.</p></li>
<li><p>Also have not thoroughly tested if only some are available for
some variables at some sites</p></li>
</ul>
</li>
<li><p><code>multiplier</code> allows intervals like 5 days, by passing
<code>interval = 'day'</code> and <code>multiplier = 5</code>.</p></li>
<li>
<p><code>data_type</code> is the statistic to apply within each
interval to get the values.</p>
<ul>
<li><p>Options (from API error messages): <code>"mean"</code>,
<code>"max"</code>, <code>"min"</code>, <code>"start"</code>,
<code>"end"</code>, <code>"first"</code>, <code>"last"</code>,
<code>"tot"</code>, <code>"maxmin"</code>, <code>"point"</code>,
<code>"cum"</code>. Not all are currently tested.</p></li>
<li><p><em>Warning:</em> any given API call can only takes one value,
which is applied to all variables. <em>This is unlikely to be
appropriate if asking for many variables.</em></p></li>
<li><p>run <code><a href="../reference/get_ts_traces.html">get_ts_traces()</a></code> multiple times, with different
subsets of <code>var_type</code>, each with an appropriate
<code>data_types</code></p></li>
</ul>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Galen Holt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
