<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>KiWIS wrapper • hydrogauge</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="KiWIS wrapper">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrogauge</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/hydrogauge.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/hydrogauge.html">hydrogauge</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-traces-workflow.html">hydstra workflow</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-workflow.html">KiWIS workflow</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-wrapper.html">hydstra wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-wrapper.html">KiWIS wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/data-portals.html">Data portals</a></li>
    <li><a class="dropdown-item" href="../articles/BOM_quality_codes.html">BOM quality codes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/galenholt/hydrogauge/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>KiWIS wrapper</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/galenholt/hydrogauge/blob/HEAD/vignettes/articles/kiwis-wrapper.Rmd" class="external-link"><code>vignettes/articles/kiwis-wrapper.Rmd</code></a></small>
      <div class="d-none name"><code>kiwis-wrapper.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/galenholt/hydrogauge/" class="external-link">hydrogauge</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries()</a></code> function wraps
<code><a href="../reference/find_ts_id.html">find_ts_id()</a></code> (which itself wraps
<code><a href="../reference/getTimeseriesList.html">getTimeseriesList()</a></code>) and
<code><a href="../reference/getTimeseriesValues.html">getTimeseriesValues()</a></code>, which allows some extra
functionality and smoother workflows but also introduces some danger.
Unlike <code><a href="../reference/fetch_hydstra_timeseries.html">fetch_hydstra_timeseries()</a></code>, though,
<code><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries()</a></code> tends to increase efficiency of
the API requests. Some argument names have been changed compared to
<code><a href="../reference/getTimeseriesValues.html">getTimeseriesValues()</a></code> (which gives the user full access to
KiWIS names) for more clarity and to move towards a unified interface
across both API styles.</p>
<div class="section level2">
<h2 id="period-of-record">Period of record<a class="anchor" aria-label="anchor" href="#period-of-record"></a>
</h2>
<p>This function is most useful when we want to pull the period of
record of the same variable for a set of gauges, especially if we want
to choose that variable by name and not <code>ts_id</code> code. For
example, we might want to pull discharge for the period of record. We
would define the period of record by passing <code>'all'</code> to
<code>start_time</code> and <code>end_time</code>, or
<code>period = 'complete'</code>. We can choose daily mean discharge in
ML/d with <code>variable = 'discharge'</code>,
<code>units = 'ML/d'</code>, and <code>statistic = 'mean'</code>,
yielding @ref(fig:discharge-period).</p>
<div class="callout-caution">
<p>Choosing the ts_id codes from <code>variable</code>,
<code>units</code>, <code>statistic</code> and <code>datatype</code>
uses regex in <code><a href="../reference/find_ts_id.html">find_ts_id()</a></code>, and is not guaranteed to yield
one and only one result. This can be handy, in that we can use
wildcards, but also can lead to extra data sneaking in (e.g. 9am and
midnight daily start times). Check your data carefully for extra
variables or duplication. For large calls, it is a good idea to run
<code><a href="../reference/find_ts_id.html">find_ts_id()</a></code> manually and check the output has no surprises
before pulling the timeseries.</p>
</div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">discharge_record</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>                                           gauge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'410730'</span>, <span class="st">'A4260505'</span><span class="op">)</span>,</span>
<span>                                           period <span class="op">=</span> <span class="st">'complete'</span>,</span>
<span>                                           variable <span class="op">=</span> <span class="st">'discharge'</span>, </span>
<span>                                           units <span class="op">=</span> <span class="st">'ML/d'</span>,</span>
<span>                                           timeunit <span class="op">=</span> <span class="st">'Daily'</span>, </span>
<span>                                           statistic <span class="op">=</span> <span class="st">'mean'</span>,</span>
<span>                                           datatype <span class="op">=</span> <span class="st">'QaQc'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: future</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">discharge_record</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">station_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">station_name</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">'free'</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-wrapper_files/figure-html/fig-discharge-period-1.png" alt="Discharge for the period of record for three gauges." width="700"><p class="caption">
Discharge for the period of record for three gauges.
</p>
</div>
<p>The use of <code>extra_list</code> lets us use regex to select
gauges, as well as pre-select some of the desired data by limiting what
gets returned by find_ts_id() (the ’*24HR’ limits which daily start we
use). Many of these only report cumecs, not ML/d.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">murray_discharge</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>                                           extra_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>station_name <span class="op">=</span> <span class="st">'River Murray*'</span>,</span>
<span>                                                             ts_name <span class="op">=</span> <span class="st">'*24HR'</span><span class="op">)</span>,</span>
<span>                                           period <span class="op">=</span> <span class="st">'complete'</span>,</span>
<span>                                           variable <span class="op">=</span> <span class="st">'discharge'</span>, </span>
<span>                                           units <span class="op">=</span> <span class="st">'cumec'</span>,</span>
<span>                                           timeunit <span class="op">=</span> <span class="st">'Daily'</span>, </span>
<span>                                           statistic <span class="op">=</span> <span class="st">'mean'</span>,</span>
<span>                                           datatype <span class="op">=</span> <span class="st">'QaQc'</span><span class="op">)</span></span>
<span></span>
<span>                           </span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">murray_discharge</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">station_no</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">station_no</span> <span class="op">~</span> <span class="va">.</span>, scales <span class="op">=</span> <span class="st">'free'</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'none'</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 34 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-wrapper_files/figure-html/fig-murray-discharge-1.png" alt="Discharge for the period of record for all gauges starting with 'River Murray'." width="700"><p class="caption">
Discharge for the period of record for all gauges starting with ‘River
Murray’.
</p>
</div>
</div>
<div class="section level2">
<h2 id="multiple-variables">Multiple variables<a class="anchor" aria-label="anchor" href="#multiple-variables"></a>
</h2>
<p>Unlike <code><a href="../reference/fetch_hydstra_timeseries.html">fetch_hydstra_timeseries()</a></code>, we don’t need to
worry about misaggregating different variables here, because each
aggregation has its own <code>ts_id</code>. On the other hand, because
the selection of ts_ids uses regex OR, we can’t use matched vectors here
to get different aggregations for different variables (though that may
happen if an aggregation isn’t available for some variables, e.g. daily
mean rainfall).</p>
<p>Instead, we pass in the regex, let it choose with OR, and check the
output very carefully, potentially deleting unwanted data. Or make
separate calls, which will tend to be safer. This OR pattern can be
useful for more than variables as well, allowing us to choose multiple
time periods or</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>                                   gauge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'410730'</span>, <span class="st">'A4260505'</span><span class="op">)</span>,</span>
<span>                                   variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'discharge'</span>, <span class="st">'Rainfall'</span><span class="op">)</span>,</span>
<span>                                   units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cumec'</span>, <span class="st">'mm'</span><span class="op">)</span>,</span>
<span>                                   timeunit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Daily'</span>, <span class="st">'Monthly'</span><span class="op">)</span>,</span>
<span>                                   statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>, <span class="st">'Total'</span><span class="op">)</span>,</span>
<span>                                   datatype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'QaQc'</span><span class="op">)</span>,</span>
<span>                                   <span class="co"># If I want monthly to return, need to cross a month boundary.</span></span>
<span>                                   start_time <span class="op">=</span> <span class="st">'2019-12-01 01:30:30'</span>,</span>
<span>                                   end_time <span class="op">=</span> <span class="st">'20201231'</span><span class="op">)</span></span></code></pre></div>
<p>The results here (@ref(fig:multi-var)) exemplify some of the benefits
and pitfalls. We get two Daily Mean and Daily Total results that are
shifted, one at 9am and the other midnight. We do though get Daily and
Monthly aggregations for both discharge and rainfall with one call. We
could clean up the 9/midnight duplication by using
<code>datatype = c('QaQc.*09', 'QaQc.*Month')</code>, but an
illustration was warranted.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multi_ts</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ts_name <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="va">ts_name</span>, <span class="st">'\\.'</span>, <span class="st">' '</span><span class="op">)</span>,</span>
<span>                ts_name <span class="op">=</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove_all</a></span><span class="op">(</span><span class="va">ts_name</span>, <span class="st">'DMQaQc Merged'</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">parametertype_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">ts_name</span> <span class="op">~</span> <span class="va">station_no</span>, scales <span class="op">=</span> <span class="st">'free'</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labellers.html" class="external-link">label_wrap_gen</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="kiwis-wrapper_files/figure-html/fig-multi-var-1.png" alt="Multiple variables, time periods, and aggregations." width="700"><p class="caption">
Multiple variables, time periods, and aggregations.
</p>
</div>
</div>
<div class="section level2">
<h2 id="obtaining-ts_ids">Obtaining ts_ids<a class="anchor" aria-label="anchor" href="#obtaining-ts_ids"></a>
</h2>
<p>The key to pulling KiWIS records is to use either <code>ts_id</code>
or <code>ts_path</code>. The <code>ts_path</code> can theoretically be
constructed on the fly, but it is tricky to generalise and get right.
Instead, we tend to use the <code>ts_id</code>, finding it by regex with
other columns. This is the key to culling the full set of potential
timeseries returned by <code><a href="../reference/getTimeseriesList.html">getTimeseriesList()</a></code> to a desired set
to pull.</p>
<p>Even if using the base API, looking through the ts_ids for each
gauge, variable, aggregation, etc can be slow and error-prone. Instead,
<code><a href="../reference/find_ts_id.html">find_ts_id()</a></code> gives an interface to search this dataframe,
filtering it according to a set of desired timeseries. This is done
internally to fetch_kiwis_timeseries(), but can also be very useful for
manually searching for available and desired timeseries to pull.</p>
<p>For example, with a pre-check with <code><a href="../reference/find_ts_id.html">find_ts_id()</a></code>, we
would have found the duplication above:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ts_check</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_ts_id.html">find_ts_id</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>           gauge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'410730'</span>, <span class="st">'A4260505'</span><span class="op">)</span>,</span>
<span>           variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'discharge'</span>, <span class="st">'Rainfall'</span><span class="op">)</span>,</span>
<span>           units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cumec'</span>, <span class="st">'mm'</span><span class="op">)</span>,</span>
<span>           timeunit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Daily'</span>, <span class="st">'Monthly'</span><span class="op">)</span>,</span>
<span>           statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>, <span class="st">'Total'</span><span class="op">)</span>,</span>
<span>           datatype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'QaQc'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ts_check</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">station_no</span>, <span class="va">ts_id</span>, <span class="va">ts_name</span>, <span class="va">ts_unitname</span>, <span class="va">parametertype_name</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">station_no</span>, <span class="va">parametertype_name</span>, <span class="va">ts_name</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 14</span></span></span>
<span><span class="co">#&gt;   station_no ts_id     ts_name       ts_unitname parametertype_name station_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 410730     1555010   DMQaQc.Merge… millimeter  Rainfall           Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 410730     1554010   DMQaQc.Merge… millimeter  Rainfall           Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 410730     1556010   DMQaQc.Merge… millimeter  Rainfall           Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 410730     1572010   DMQaQc.Merge… cubic mete… Water Course Disc… Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 410730     1573010   DMQaQc.Merge… cubic mete… Water Course Disc… Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 410730     1574010   DMQaQc.Merge… cubic mete… Water Course Disc… Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> A4260505   208647010 DMQaQc.Merge… cubic mete… Water Course Disc… River Murra…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> A4260505   208648010 DMQaQc.Merge… cubic mete… Water Course Disc… River Murra…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span> A4260505   208649010 DMQaQc.Merge… cubic mete… Water Course Disc… River Murra…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: station_id &lt;chr&gt;, ts_unitsymbol &lt;chr&gt;, ts_path &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parametertype_id &lt;chr&gt;, stationparameter_name &lt;chr&gt;, from &lt;chr&gt;, to &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   database_timezone &lt;chr&gt;</span></span></span></code></pre></div>
<p>And then we could have determined how we needed to change the request
to get a clean call</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_check_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_ts_id.html">find_ts_id</a></span><span class="op">(</span>portal <span class="op">=</span> <span class="st">'bom'</span>,</span>
<span>           gauge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'410730'</span>, <span class="st">'A4260505'</span><span class="op">)</span>,</span>
<span>           variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'discharge'</span>, <span class="st">'Rainfall'</span><span class="op">)</span>,</span>
<span>           units <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'cumec'</span>, <span class="st">'mm'</span><span class="op">)</span>,</span>
<span>           timeunit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Daily'</span>, <span class="st">'Monthly'</span><span class="op">)</span>,</span>
<span>           statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Mean'</span>, <span class="st">'Total'</span><span class="op">)</span>,</span>
<span>           datatype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'QaQc.*09'</span>, <span class="st">'QaQc.*Month'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ts_check_clean</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">station_no</span>, <span class="va">ts_id</span>, <span class="va">ts_name</span>, <span class="va">ts_unitname</span>, <span class="va">parametertype_name</span>, <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">station_no</span>, <span class="va">parametertype_name</span>, <span class="va">ts_name</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 14</span></span></span>
<span><span class="co">#&gt;   station_no ts_id     ts_name       ts_unitname parametertype_name station_name</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 410730     1555010   DMQaQc.Merge… millimeter  Rainfall           Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 410730     1556010   DMQaQc.Merge… millimeter  Rainfall           Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 410730     1572010   DMQaQc.Merge… cubic mete… Water Course Disc… Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 410730     1574010   DMQaQc.Merge… cubic mete… Water Course Disc… Cotter R. a…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> A4260505   208647010 DMQaQc.Merge… cubic mete… Water Course Disc… River Murra…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> A4260505   208649010 DMQaQc.Merge… cubic mete… Water Course Disc… River Murra…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: station_id &lt;chr&gt;, ts_unitsymbol &lt;chr&gt;, ts_path &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   parametertype_id &lt;chr&gt;, stationparameter_name &lt;chr&gt;, from &lt;chr&gt;, to &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   database_timezone &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="large-requests">Large requests<a class="anchor" aria-label="anchor" href="#large-requests"></a>
</h2>
<p><em>Note: with big pulls, it can be useful to use
<code><a href="../reference/find_ts_id.html">find_ts_id()</a></code> and <code><a href="../reference/getTimeseriesValues.html">getTimeseriesValues()</a></code>
approach, or at least a manual check of <code><a href="../reference/find_ts_id.html">find_ts_id()</a></code> prior
to using <code><a href="../reference/fetch_kiwis_timeseries.html">fetch_kiwis_timeseries()</a></code>.</em> In my experience,
there are often errors with some gauges or other issues that mean clean
pulls need some troubleshooting of the variable availability etc. It is
often easiest to find and solve problems if you check what you’re
actually trying to pull.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Galen Holt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
