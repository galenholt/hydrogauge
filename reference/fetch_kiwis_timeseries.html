<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Wrapper for Kiwis to find and return desired timeseries — fetch_kiwis_timeseries • hydrogauge</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Wrapper for Kiwis to find and return desired timeseries — fetch_kiwis_timeseries"><meta name="description" content="Wraps getTimeseriesList() (via find_ts_id()) and getTimeseriesValues()
to find the ts_id that matches the sort of timeseries we want and go get it
(them) For help with the arguments, run ts_list &amp;lt;- getTimeseriesList(portal = portal, station_no = gauge) to see the getTimeseriesList() output that
is parsed to give the ts_id. This can be very helpful if you're getting
incorrect records or too many or not enough. Each argument below says which
column it filters on, using grepl() with ignore.case = TRUE"><meta property="og:description" content="Wraps getTimeseriesList() (via find_ts_id()) and getTimeseriesValues()
to find the ts_id that matches the sort of timeseries we want and go get it
(them) For help with the arguments, run ts_list &amp;lt;- getTimeseriesList(portal = portal, station_no = gauge) to see the getTimeseriesList() output that
is parsed to give the ts_id. This can be very helpful if you're getting
incorrect records or too many or not enough. Each argument below says which
column it filters on, using grepl() with ignore.case = TRUE"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hydrogauge</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9010</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/hydrogauge.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/hydrogauge.html">hydrogauge</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-traces-workflow.html">hydstra workflow</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-workflow.html">KiWIS workflow</a></li>
    <li><a class="dropdown-item" href="../articles/hydstra-wrapper.html">hydstra wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/kiwis-wrapper.html">KiWIS wrapper</a></li>
    <li><a class="dropdown-item" href="../articles/data-portals.html">Data portals</a></li>
    <li><a class="dropdown-item" href="../articles/BOM_quality_codes.html">BOM quality codes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/galenholt/hydrogauge/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Wrapper for Kiwis to find and return desired timeseries</h1>
      <small class="dont-index">Source: <a href="https://github.com/galenholt/hydrogauge/blob/HEAD/R/fetch_kiwis_timeseries.R" class="external-link"><code>R/fetch_kiwis_timeseries.R</code></a></small>
      <div class="d-none name"><code>fetch_kiwis_timeseries.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Wraps <code><a href="getTimeseriesList.html">getTimeseriesList()</a></code> (via <code><a href="find_ts_id.html">find_ts_id()</a></code>) and <code><a href="getTimeseriesValues.html">getTimeseriesValues()</a></code>
to find the <code>ts_id</code> that matches the sort of timeseries we want and go get it
(them) For help with the arguments, run <code>ts_list &lt;- getTimeseriesList(portal = portal, station_no = gauge)</code> to see the <code><a href="getTimeseriesList.html">getTimeseriesList()</a></code> output that
is parsed to give the <code>ts_id</code>. This can be very helpful if you're getting
incorrect records or too many or not enough. Each argument below says which
column it filters on, using <code><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl()</a></code> with <code>ignore.case = TRUE</code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fetch_kiwis_timeseries</span><span class="op">(</span></span>
<span>  <span class="va">portal</span>,</span>
<span>  gauge <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  start_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_time <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  period <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variable <span class="op">=</span> <span class="st">"discharge"</span>,</span>
<span>  units <span class="op">=</span> <span class="st">"ML/d"</span>,</span>
<span>  timeunit <span class="op">=</span> <span class="st">"Daily"</span>,</span>
<span>  statistic <span class="op">=</span> <span class="st">"Mean"</span>,</span>
<span>  datatype <span class="op">=</span> <span class="st">"QaQc"</span>,</span>
<span>  namefilters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  extra_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  returnfields <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  meta_returnfields <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  request_timezone <span class="op">=</span> <span class="st">"db_default"</span>,</span>
<span>  return_timezone <span class="op">=</span> <span class="st">"UTC"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-portal">portal<a class="anchor" aria-label="anchor" href="#arg-portal"></a></dt>
<dd><p>URL to Kisters KiWIS database.</p></dd>


<dt id="arg-gauge">gauge<a class="anchor" aria-label="anchor" href="#arg-gauge"></a></dt>
<dd><p>character vector of gauge numbers, as <code>station_no</code> for Kiwis
functions (<code>site_list</code> for Hydstra)</p></dd>


<dt id="arg-start-time">start_time<a class="anchor" aria-label="anchor" href="#arg-start-time"></a></dt>
<dd><p>character or date or date time for the start <em>in database
default timezone</em>. Default NULL.</p></dd>


<dt id="arg-end-time">end_time<a class="anchor" aria-label="anchor" href="#arg-end-time"></a></dt>
<dd><p>character or date or date time for the end <em>in database
default timezone</em>. Default NULL.</p></dd>


<dt id="arg-period">period<a class="anchor" aria-label="anchor" href="#arg-period"></a></dt>
<dd><p>character, default NULL. The special case 'complete' returns
the full set of data. Otherwise, beginning with 'P', followed by numbers
and characers indicating timespan, e.g. 'P2W'. See
<a href="https://timeseriesdoc.sepa.org.uk/api-documentation/api-function-reference/specifying-date-and-time/" class="external-link">documentation</a>.</p></dd>


<dt id="arg-variable">variable<a class="anchor" aria-label="anchor" href="#arg-variable"></a></dt>
<dd><p>character vector of variables we want to extract. Matches on
<code>parametertype_name</code></p></dd>


<dt id="arg-units">units<a class="anchor" aria-label="anchor" href="#arg-units"></a></dt>
<dd><p>units of the variable, used when there may be &gt; 1 e.g. cumecs,
ML/d for discharge. If NULL, gets all available. Matches to <code>ts_unitsymbol</code></p></dd>


<dt id="arg-timeunit">timeunit<a class="anchor" aria-label="anchor" href="#arg-timeunit"></a></dt>
<dd><p>The time interval to request, e.g. "Daily", the default. Main
values seem to be 'Daily', 'Monthly', 'Yearly', and 'AsStored' (the raw
data). Matches to part of <code>ts_name</code></p></dd>


<dt id="arg-statistic">statistic<a class="anchor" aria-label="anchor" href="#arg-statistic"></a></dt>
<dd><p>The aggregation statistic, e.g. "Mean", the default. Main
values seem to be 'Mean', 'Max', 'Min', 'Total', though not all are
available for each variable- rainfall tends to use Total, while discharge
tends to use mean, max, min. Matches to part of <code>ts_name</code></p></dd>


<dt id="arg-datatype">datatype<a class="anchor" aria-label="anchor" href="#arg-datatype"></a></dt>
<dd><p>The type of data to return, default 'QaQc'. Some other
options seem to be 'Recieved', 'Harmonised', and 'Obs'. <em>Note</em>- 'QaQc'
matches to both 'DMQaQc' and 'PR01QaQc'. In many cases only one is
available, but if you get 2x too much data, check and specify which you
want. Matches to part of <code>ts_name</code></p></dd>


<dt id="arg-namefilters">namefilters<a class="anchor" aria-label="anchor" href="#arg-namefilters"></a></dt>
<dd><p>character vector giving the ability to match to other
parts of <code>ts_name</code> in case those specified in timeunit, statistic, and
datatype aren't sufficient to find the desired <code>ts_id</code>. One frequent
occurrence is two Daily datasets that differ in whether they split at 9am
or midnight, in which case you should use either <code>namefilters = '09HR</code> or
<code>namefilters = '24HR</code>. In some situations, this can be easier than using
regex, e.g.  <code>datatype = 'QaQc.*09'</code></p></dd>


<dt id="arg-extra-list">extra_list<a class="anchor" aria-label="anchor" href="#arg-extra-list"></a></dt>
<dd><p>a named list, see <code><a href="getStationList.html">getStationList()</a></code>, with a special note
that here we can include a 'timezone' argument that determines the timezone
the API returns in. This is dangerous, since the API ingests dates in its
own default timezone and that is inferred from the return in the absence of
the ability to extract it. Thus, including a <code>timezone</code> in <code>extra_list</code> may
yield unexpected outcomes when requesting dates. A better option is to use
<code>return_timezone</code> to adjust the return values. That said, it may be that
some databases return gauge-local tzs, which won't be allowed to be
concatenated. A solution would be to just work in UTC with <code>timezone = 'UTC'</code> in extralist to make all outputs on the same tz.</p></dd>


<dt id="arg-returnfields">returnfields<a class="anchor" aria-label="anchor" href="#arg-returnfields"></a></dt>
<dd><p>return fields for the data itself. Default is
<code>c('Timestamp', 'Value', 'Quality Code')</code>. Full list from <a href="https://timeseries.sepa.org.uk/KiWIS/KiWIS?datasource=0&amp;service=kisters&amp;type=queryServices&amp;request=getrequestinfo" class="external-link">Kisters docs</a>)</p></dd>


<dt id="arg-meta-returnfields">meta_returnfields<a class="anchor" aria-label="anchor" href="#arg-meta-returnfields"></a></dt>
<dd><p>return fields about the variable and site. seems to
be able to access most of what <code><a href="getTimeseriesList.html">getTimeseriesList()</a></code> has in its
<code>returnfields</code>. Full list from <a href="https://timeseries.sepa.org.uk/KiWIS/KiWIS?datasource=0&amp;service=kisters&amp;type=queryServices&amp;request=getrequestinfo" class="external-link">Kisters docs</a>)</p></dd>


<dt id="arg-request-timezone">request_timezone<a class="anchor" aria-label="anchor" href="#arg-request-timezone"></a></dt>
<dd><p>ignored if start_time and end_time are time objects,
otherwise a timezone from <code><a href="https://rdrr.io/r/base/timezones.html" class="external-link">OlsonNames()</a></code> or 'db_default'</p></dd>


<dt id="arg-return-timezone">return_timezone<a class="anchor" aria-label="anchor" href="#arg-return-timezone"></a></dt>
<dd><p>character in <code><a href="https://rdrr.io/r/base/timezones.html" class="external-link">OlsonNames()</a></code> or one of three special
cases: <code>'db_default'</code>, <code>'char'</code> or <code>'raw'</code>. Default 'UTC'. If 'db_default',
uses the API default. BOM defaults to +10. If <code>'char'</code> or <code>'raw'</code>, returns
the time column as-is from the API (A string in the format
<code>'YYYY-MM-DDTHH:MM:SS+TZ'</code>)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a tibble of the requested timeseries</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that while each of the filtering arguments <code>variable</code>, <code>units</code>,
<code>timeunit</code>, <code>statistic</code>, and <code>datatype</code> can be vectors, they are not
positionally matched. Each is just done as a simple OR, and so for example if
you have <code>variable = 'discharge'</code>, <code>units = c('ML/d', 'cumecs')</code>, and
<code>statistic = c('Mean', 'Min')</code>, you'll get the mean and min of <em>both</em> ML/d
and cumecs, not the mean of ML/d and min of cumecs. For more control, run
this multiple times with the desired subsets. Further, the use of <code><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl()</a></code>
allows full regex parsing. For example, many gauges have daily values that
split at 09:00 or at midnight. Using <code>datatype = 'QaQc.*09'</code> gets just the
09:00 versions.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Galen Holt.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

